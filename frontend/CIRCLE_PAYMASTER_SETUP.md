# Circle Paymaster Setup Guide

This guide explains how to set up and test the Circle Paymaster integration on Base Sepolia.

## Prerequisites

1. **Node.js and npm** installed
2. **Privy account** for wallet authentication
3. **Base Sepolia testnet** access
4. **Test USDC** from Circle's faucet

## Environment Variables

Add these to your `.env.local` file:

```env
# Privy Configuration
NEXT_PUBLIC_PRIVY_APP_ID=your_privy_app_id

# Demo Private Key (for testing only - use a test key with no real funds)
NEXT_PUBLIC_DEMO_PRIVATE_KEY=0x0000000000000000000000000000000000000000000000000000000000000000
```

## Contract Addresses (Base Sepolia)

The implementation uses these verified contract addresses:

- **USDC**: `0x036CbD53842c5426634e7929541eC2318f3dCF7c`
- **Circle Paymaster**: `0x6C973eBe80dCD8660841D4356bf15c32460271C9`
- **Bundler**: `https://public.pimlico.io/v2/84532/rpc`

## How to Test

1. **Get Test USDC**:
   - Visit [Circle's USDC Faucet](https://faucet.circle.com)
   - Request testnet USDC for Base Sepolia
   - Send it to your smart account address (generated by the demo)

2. **Connect Wallet**:
   - Use Privy to connect your wallet
   - The app will automatically switch to Base Sepolia

3. **Test Transaction**:
   - Enter a recipient address
   - Enter amount in USDC
   - Click "Transfer with Circle Paymaster"
   - Transaction will be sponsored by Circle Paymaster

## How It Works

1. **Smart Account Creation**: Creates an ERC-4337 smart account using your wallet as the owner
2. **EIP-2612 Permit**: Signs a permit allowing Circle Paymaster to spend USDC for gas
3. **User Operation**: Constructs a user operation with the transfer call
4. **Bundler Submission**: Submits to Pimlico bundler with paymaster data
5. **Gas Payment**: Circle Paymaster pays gas fees in ETH, deducts equivalent USDC

## Key Features

- ✅ **No ETH Required**: Pay gas fees with USDC
- ✅ **ERC-4337 Compatible**: Uses Account Abstraction standard
- ✅ **Circle Backed**: Reliable paymaster service from Circle
- ✅ **Base Sepolia**: Tested on Base testnet

## Troubleshooting

### Common Issues

1. **"Insufficient USDC balance"**: 
   - Get testnet USDC from Circle's faucet
   - Ensure USDC is in your smart account, not EOA

2. **"Private key required"**:
   - Set NEXT_PUBLIC_DEMO_PRIVATE_KEY in your .env.local
   - Use a test private key with no real funds

3. **Network Issues**:
   - Ensure you're on Base Sepolia (Chain ID: 84532)
   - Check RPC endpoint connectivity

### Debug Steps

1. Check browser console for detailed error messages
2. Verify contract addresses are correct
3. Confirm USDC balance in smart account
4. Test with small amounts first

## Security Notes

⚠️ **Important**: 
- Only use test private keys with no real funds
- Never expose real private keys in environment variables
- This is a demo implementation - production use requires proper key management

## Next Steps

To use in production:
1. Implement proper private key management
2. Add transaction confirmations
3. Handle edge cases and errors
4. Add proper user feedback
5. Test with real funds on mainnet

## Resources

- [Circle Paymaster Documentation](https://docs.arbitrum.io/for-devs/third-party-docs/Circle/usdc-paymaster-quickstart)
- [ERC-4337 Standard](https://eips.ethereum.org/EIPS/eip-4337)
- [Base Sepolia Faucet](https://faucet.quicknode.com/base/sepolia)
- [Circle USDC Faucet](https://faucet.circle.com) 